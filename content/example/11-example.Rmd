---
title: "Data Wrangling"
linktitle: "11: Data Wrangling"
output:
  blogdown::html_page:
    toc: true
menu:
  example:
    parent: Examples
    weight: 2
type: docs
weight: 1
editor_options:
  chunk_output_type: console
---


# Airbnb and Weather Data

In this exercise, you will practice your data wrangling skills by working with two datasets: Airbnb property listings and local weather data. You will first clean and preprocess the data using various techniques, and then join the datasets to explore the relationship between weather conditions and rental prices or availability. This hands-on exercise will help you gain practical experience in handling real-world data and extracting insights from it.

Exercise

1. Load the Airbnb dataset for a city of your choice from [Inside Airbnb](http://insideairbnb.com/get-the-data/) and preprocess it as follows:
  - Clean and format variables like price, cleaning_fee, and host_since
  - Filter listings based on certain criteria, such as room type, number of guests, bedrooms, and bathrooms
  - Calculate new variables, like `host_duration`

2. Obtain historical weather data for the same city from a source like NOAA Climate Data Online (CDO) or use APIs like [OpenWeather](https://openweathermap.org/api) and preprocess it:
  - Clean and format weather variables like `date`
  - Aggregate weather data by month and year to calculate average temperature and precipitation

3. Join the Airbnb and weather datasets using the `first_review` date in the Airbnb dataset and the aggregated weather data.

4. Perform exploratory data analysis using the combined dataset to answer at least one of the following questions:
  - Is there a relationship between the average temperature during the month of the first review and the rental price? Create a scatter plot to visualize the relationship, and fit a linear regression line to the data.
  - How does the average precipitation during the month of the first review impact the rental price? Create a scatter plot to visualize the relationship, and fit a linear regression line to the data.
  - Do listings with higher review scores tend to be in months with higher or lower temperatures? Calculate the correlation between average temperature and review scores.
  - Investigate if any particular neighborhood experiences higher average temperatures or precipitation levels during the first review. Create a bar chart to display the average weather conditions by neighborhood.

**Note:** This exercise, which is your weekly writing, is designed to be completed in approximately 90 minutes but may take a bit longer. If you face any odd issues or need clarification, don't hesitate to ask. Some miscellaneous sample code is below, but functionality is not guaranteed. 



```{r, eval=FALSE, echo=TRUE}
# Load necessary packages
library(tidyverse)
library(lubridate)

# 1. Load weather data
weather <- read_csv("weather.csv")

# 2. Clean and format weather variables
weather_clean <- weather %>%
  mutate(date = ymd(date),
         month = month(date),
         year = year(date)
  )

# 3. Aggregate weather data
weather_summary <- weather_clean %>%
  group_by(year, month) %>%
  summarize(avg_temp = mean(temperature, na.rm = TRUE),
            avg_precip = mean(precipitation, na.rm = TRUE)
  )

# 4. Join Airbnb and weather data
listings_weather <- listings_clean %>%
  mutate(month = month(first_review),
         year = year(first_review)
  ) %>%
  left_join(weather_summary, by = c("year", "month"))

# Example analysis: Explore the relationship between average temperature and price
ggplot(listings_weather, aes(x = avg_temp, y = price)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Relationship between Average Temperature and Airbnb Price",
       x = "Average Temperature (Â°F)",
       y = "Price ($)"
  )

# Convert temperature from Fahrenheit to Celsius
weather_clean <- weather_clean %>%
  mutate(temperature_c = (temperature - 32) * 5/9)
Replace missing values in a variable:

# Replace missing values in the review_scores_rating variable with the mean rating
listings_clean <- listings_clean %>%
  mutate(review_scores_rating = if_else(is.na(review_scores_rating),
                                        mean(review_scores_rating, na.rm = TRUE),
                                        review_scores_rating))

# Calculate the correlation between average temperature and review_scores_rating
correlation <- cor(listings_weather$avg_temp, listings_weather$review_scores_rating, use = "pairwise.complete.obs")

# Create a bar chart comparing average weather conditions by neighborhood:
listings_weather %>%
  group_by(neighbourhood) %>%
  summarize(avg_temp_neigh = mean(avg_temp, na.rm = TRUE),
            avg_precip_neigh = mean(avg_precip, na.rm = TRUE)
  ) %>%
  gather(key = "weather_variable", value = "value", avg_temp_neigh, avg_precip_neigh) %>%
  ggplot(aes(x = reorder(neighbourhood, value), y = value, fill = weather_variable)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Average Weather Conditions by Neighborhood",
       x = "Neighborhood",
       y = "Value",
       fill = "Weather Variable"
  )

```